<!DOCTYPE html>
<html>
<head>
    <title>Калькулятор</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f0f4f7;
            color: #333;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
        }
        .form-container {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 30px;
            max-width: 600px;
            width: 100%;
            margin-bottom: 20px;
        }
        h1 {
            text-align: center;
            color: #007BFF;
            font-weight: 700;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        select, input[type="number"] {
            padding: 10px;
            width: 100%;
            border-radius: 5px;
            border: 1px solid #ddd;
            box-sizing: border-box;
        }
        .price-display {
            margin-top: 10px;
            font-weight: 600;
            color: #007BFF;
        }
        .result-container {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 30px;
            max-width: 600px;
            width: 100%;
            text-align: center;
        }
        .result-container h1 {
            color: #007BFF;
            font-weight: 700;
        }
        .result-container p {
            font-weight: 600;
            margin-bottom: 15px;
        }

        /* Адаптивный дизайн для мобильных устройств */
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            .form-container, .result-container {
                padding: 15px;
                margin: 10px;
                max-width: 100%;
                box-shadow: none;
            }
            h1 {
                font-size: 1.5em;
                margin-bottom: 15px;
            }
            .form-group {
                margin-bottom: 15px;
            }
            select, input[type="number"] {
                font-size: 1em;
                padding: 8px;
            }
            .price-display, .result-container p {
                font-size: 1em;
            }
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const fabricSelect = document.getElementById('id_fabric');
            const quadratureInput = document.getElementById('id_quadrature');
            const installationInput = document.getElementById('id_installation');
            const paymentSelect = document.getElementById('id_payment');

            const priceDisplay = document.getElementById('fabric-price');
            const totalAmountDisplay = document.querySelector('.total-amount');
            const totalWithDiscountDisplay = document.querySelector('.total-with-discount');
            const finalAmountDisplay = document.querySelector('.final-amount');

            function calculateDiscount(totalAmount) {
                if (totalAmount >= 1000 && totalAmount < 10000) return 5;
                if (totalAmount >= 10000 && totalAmount < 20000) return 10;
                if (totalAmount >= 20000 && totalAmount < 30000) return 15;
                if (totalAmount >= 30000 && totalAmount < 40000) return 18;
                if (totalAmount >= 40000) return 20;
                return 0;
            }

            function updatePrice() {
                const selectedOption = fabricSelect.options[fabricSelect.selectedIndex];
                const fabricPrice = parseFloat(selectedOption.getAttribute('data-price')) || 0;
                const quadrature = parseFloat(quadratureInput.value) || 0;
                const installation = parseFloat(installationInput.value) || 0;

                const paymentOption = paymentSelect.options[paymentSelect.selectedIndex];
                const paymentPercentage = parseFloat(paymentOption.getAttribute('data-percentage')) || 0;

                const totalAmount = (fabricPrice * quadrature) + installation;
                const discount = calculateDiscount(totalAmount);
                const totalWithDiscount = totalAmount * ((100 - discount) / 100);
                const finalAmount = totalWithDiscount * ((100 + paymentPercentage) / 100);

                priceDisplay.textContent = `Цена ткани: ${fabricPrice.toFixed(2)} сом`;
                totalAmountDisplay.textContent = `Общая сумма: ${totalAmount.toFixed(2)} сом`;
                totalWithDiscountDisplay.textContent = `Итого со скидкой (${discount}%): ${totalWithDiscount.toFixed(2)} сом`;
                finalAmountDisplay.textContent = `Итого с оплатой: ${finalAmount.toFixed(2)} сом`;
            }

            fabricSelect.addEventListener('change', updatePrice);
            quadratureInput.addEventListener('input', updatePrice);
            installationInput.addEventListener('input', updatePrice);
            paymentSelect.addEventListener('change', updatePrice);

            updatePrice();
        });
    </script>
</head>
<body>
    <div class="form-container">
        <h1>Калькулятор</h1>
        <form method="post">
            {% csrf_token %}
            <div class="form-group">
                <label for="{{ form.fabric.id_for_label }}">Ткань</label>
                <select name="{{ form.fabric.name }}" id="{{ form.fabric.id_for_label }}">
                    <option value="" data-price="0">-- Выберите ткань --</option>
                    {% for fabric in form.fabric.field.queryset %}
                        <option value="{{ fabric.id }}" data-price="{{ fabric.price }}">
                            {{ fabric.fabric }}
                        </option>
                    {% endfor %}
                </select>
                <div id="fabric-price" class="price-display"></div>
            </div>
            <div class="form-group">
                <label for="{{ form.quadrature.id_for_label }}">Квадратура (м²)</label>
                {{ form.quadrature }}
            </div>
            <div class="form-group">
                <label for="{{ form.installation.id_for_label }}">Установка (сом)</label>
                {{ form.installation }}
            </div>
            <div class="form-group">
                <label for="{{ form.payment.id_for_label }}">Оплата</label>
                <select name="{{ form.payment.name }}" id="{{ form.payment.id_for_label }}">
                    <option value="" data-percentage="0">-- Выберите способ оплаты --</option>
                    {% for payment in form.payment.field.queryset %}
                        <option value="{{ payment.id }}" data-percentage="{{ payment.percentage }}">
                            {{ payment }}
                        </option>
                    {% endfor %}
                </select>
            </div>
        </form>
    </div>

    <div class="result-container">
        <h1>Результаты</h1>
        <p class="total-amount"></p>
        <p class="total-with-discount"></p>
        <p class="final-amount"></p>
    </div>
</body>
</html>
