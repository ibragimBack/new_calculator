<!DOCTYPE html>
<html>
<head>
    <title>Калькулятор</title>
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f0f4f7;
            color: #333;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
        }
        .form-container {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 30px;
            max-width: 600px;
            width: 100%;
            margin-bottom: 20px;
        }
        h1 {
            text-align: center;
            color: #007BFF;
            font-weight: 700;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        select, input[type="number"] {
            padding: 10px;
            width: 100%;
            border-radius: 5px;
            border: 1px solid #ddd;
            box-sizing: border-box;
        }
        .price-display {
            margin-top: 10px;
            font-weight: 600;
            color: #007BFF;
        }
        .result-container {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 30px;
            max-width: 600px;
            width: 100%;
            text-align: center;
        }
        .result-container h1 {
            color: #007BFF;
            font-weight: 700;
        }
        .result-container p {
            font-weight: 600;
            margin-bottom: 15px;
        }

        /* Адаптивный дизайн */
        @media (max-width: 600px) {
            .form-container, .result-container {
                padding: 20px;
                margin: 10px;
            }
            h1 {
                font-size: 1.5em;
                margin-bottom: 15px;
            }
            .form-group {
                margin-bottom: 15px;
            }
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const fabricSelect = document.getElementById('id_fabric');
            const quadratureInput = document.getElementById('id_quadrature');
            const installationInput = document.getElementById('id_installation');
            const discountInput = document.getElementById('id_discount');
            const paymentSelect = document.getElementById('id_payment');

            const priceDisplay = document.getElementById('fabric-price');
            const totalAmountDisplay = document.querySelector('.total-amount');
            const totalWithDiscountDisplay = document.querySelector('.total-with-discount');
            const finalAmountDisplay = document.querySelector('.final-amount');

            function updatePrice() {
                const selectedOption = fabricSelect.options[fabricSelect.selectedIndex];
                const fabricPrice = parseFloat(selectedOption.getAttribute('data-price')) || 0;
                const quadrature = parseFloat(quadratureInput.value) || 0;
                const installation = parseFloat(installationInput.value) || 0;
                const discount = parseFloat(discountInput.value) || 0;

                const paymentOption = paymentSelect.options[paymentSelect.selectedIndex];
                const paymentPercentage = parseFloat(paymentOption.getAttribute('data-percentage')) || 0;

                const totalAmount = (fabricPrice * quadrature) + installation;
                const totalWithDiscount = totalAmount * ((100 - discount) / 100);
                const finalAmount = totalWithDiscount * ((100 + paymentPercentage) / 100);

                priceDisplay.textContent = `Цена ткани: ${fabricPrice.toFixed(2)} сом`;
                totalAmountDisplay.textContent = `Общая сумма: ${totalAmount.toFixed(2)} сом`;
                totalWithDiscountDisplay.textContent = `Итого со скидкой: ${totalWithDiscount.toFixed(2)} сом`;
                finalAmountDisplay.textContent = `Итого с оплатой: ${finalAmount.toFixed(2)} сом`;
            }

            // Обновляем результаты при изменении любого поля
            fabricSelect.addEventListener('change', updatePrice);
            quadratureInput.addEventListener('input', updatePrice);
            installationInput.addEventListener('input', updatePrice);
            discountInput.addEventListener('input', updatePrice);
            paymentSelect.addEventListener('change', updatePrice);

            updatePrice(); // Обновляем цену при загрузке страницы
        });
    </script>
</head>
<body>
    <div class="form-container">
        <h1>Калькулятор</h1>
        <form method="post">
            {% csrf_token %}
            <div class="form-group">
                <label for="{{ form.fabric.id_for_label }}">Ткань</label>
                <select name="{{ form.fabric.name }}" id="{{ form.fabric.id_for_label }}">
                    {% for fabric in form.fabric.field.queryset %}
                        <option value="{{ fabric.id }}" data-price="{{ fabric.price }}">
                            {{ fabric.fabric }}
                        </option>
                    {% endfor %}
                </select>
                <div id="fabric-price" class="price-display"></div>
            </div>
            <div class="form-group">
                <label for="{{ form.quadrature.id_for_label }}">Квадратура (м²)</label>
                {{ form.quadrature }}
            </div>
            <div class="form-group">
                <label for="{{ form.installation.id_for_label }}">Установка (сом)</label>
                {{ form.installation }}
            </div>
            <div class="form-group">
                <label for="{{ form.payment.id_for_label }}">Оплата</label>
                <select name="{{ form.payment.name }}" id="{{ form.payment.id_for_label }}">
                    {% for payment in form.payment.field.queryset %}
                        <option value="{{ payment.id }}" data-percentage="{{ payment.percentage }}">
                            {{ payment }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="{{ form.discount.id_for_label }}">Скидка (%)</label>
                {{ form.discount }}
            </div>
        </form>
    </div>

    <div class="result-container">
        <h1>Результаты</h1>
        <p class="total-amount"></p>
        <p class="total-with-discount"></p>
        <p class="final-amount"></p>
    </div>
</body>
</html>
